<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <title>êµí†µ ì •ë³´ ì§€ë„</title>

  <!-- âœ… Favicon -->
  <link rel="icon" href="/image/main/icon.png" type="image/png">

  <!-- âœ… Bootstrap & ì™¸ë¶€ ê³µí†µ ë¦¬ì†ŒìŠ¤ -->
  <link href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
    rel="stylesheet">

  <!-- âœ… jQuery (í•­ìƒ Bootstrap JSë³´ë‹¤ ë¨¼ì €!) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- âœ… Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- âœ… í”„ë¡œì íŠ¸ ì „ìš© CSS & JS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" th:href="@{/css/home.css}">
  <link rel="stylesheet" th:href="@{/css/traffic.css}">
  <script th:src="@{/js/home.js}" defer></script>
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=ge5761tj1f"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script th:inline="javascript">
    /*<![CDATA[*/
    const ITS_API_KEY = /*[[${itsApiKey}]]*/ '';
    window.ITS_API_KEY = ITS_API_KEY;
    /*]]>*/
  </script>

</head>

<body class="d-flex flex-column min-vh-100">
  <!-- âœ… ë„¤ë¸Œë°” -->
  <nav class="navbar navbar-expand-lg px-4 position-relative">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu"
      aria-controls="mobileMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- ì›¹(ë°ìŠ¤í¬í†±)ìš© ë¡œê³  -->
    <a class="navbar-brand d-none d-lg-block position-absolute top-0 mt-2 ms-3" style="z-index: 1020;" th:href="@{/}">
      <!-- ë¼ì´íŠ¸ ëª¨ë“œ ë¡œê³  -->
      <img src="/image/main/logo-light.png" alt="Logo Light" class="logo-light" style="height: 40px;">
      <!-- ë‹¤í¬ ëª¨ë“œ ë¡œê³  -->
      <img src="/image/main/logo-dark.png" alt="Logo Dark" class="logo-dark" style="height: 40px;">
    </a>

    <div class="position-absolute end-0 top-0 mt-2 me-3 d-flex align-items-center gap-2">
      <th:block sec:authorize="isAuthenticated()">
        <div class="dropdown">
          <button class="btn login-btn dropdown-toggle rounded-pill px-3 py-2" type="button" id="userDropdown"
            data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-1"></i> ë‚´ì •ë³´
          </button>
          <ul class="dropdown-menu dropdown-menu-end my-2 auth-dropdown" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" th:href="@{/member/mypage}">ë§ˆì´í˜ì´ì§€</a></li>
            <li>
              <form th:action="@{/logout}" method="post">
                <button type="submit" class="dropdown-item">ë¡œê·¸ì•„ì›ƒ</button>
              </form>
            </li>
          </ul>
        </div>
      </th:block>
      <th:block sec:authorize="isAnonymous()">
        <a th:href="@{/auth/login}" class="btn login-btn rounded-pill px-3 py-2">
          <i class="bi bi-person-circle me-1"></i> ë¡œê·¸ì¸
        </a>
      </th:block>
      <button id="toggle-mode" class="btn btn-outline-light">ğŸŒ™</button>
    </div>

    <!-- ëª¨ë°”ì¼ ë©”ë‰´ ì•ˆì— ìˆëŠ” ë¡œê³  -->
    <div class="collapse navbar-collapse justify-content-center" id="mobileMenu">
      <div class="d-lg-none text-center w-100">
        <a class="navbar-brand d-lg-none mt-2 d-inline-block" th:href="@{/}">
          <!-- ë¼ì´íŠ¸ ëª¨ë“œ ë¡œê³  -->
          <img src="/image/main/logo-light.png" alt="Logo Light" class="logo-light" style="height: 40px;">
          <!-- ë‹¤í¬ ëª¨ë“œ ë¡œê³  -->
          <img src="/image/main/logo-dark.png" alt="Logo Dark" class="logo-dark" style="height: 40px;">
        </a>
        <hr />
      </div>

      <ul class="navbar-nav text-center">
        <li class="nav-item position-relative">
          <a class="nav-link d-flex align-items-center justify-content-center" href="#" id="mobileBoardDropdown"
            data-bs-toggle="collapse" data-bs-target="#boardDropdownMenu" aria-expanded="false"
            aria-controls="boardDropdownMenu">
            ê²Œì‹œíŒ
            <i class="bi bi-chevron-down ms-2 arrow-icon"></i>
          </a>
          </a>
          <div class="collapse" id="boardDropdownMenu">
            <ul class="list-unstyled ps-0">
              <li><a class="dropdown-item text-center" th:href="@{/board/list(categoryId=2)}">ììœ ê²Œì‹œíŒ</a></li>
              <li><a class="dropdown-item text-center" th:href="@{/board/list(categoryId=3)}">ë¯¼ì›ê²Œì‹œíŒ</a></li>
            </ul>
          </div>
        </li>
        <li class="nav-item"><a class="nav-link" th:href="@{/chart-view}">í†µê³„ & ìë£Œ</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/pages/map/traffic}">ì§€ë„</a></li>
        <li class="nav-item"><a class="nav-link" th:href="@{/news-view}">ë‰´ìŠ¤</a></li>
        <li class="nav-item"><a class="nav-link" href="#weather">ë‚ ì”¨</a></li>
      </ul>
    </div>
  </nav>

  <!-- âœ… ë³¸ë¬¸ -->
  <div class="main-content d-flex">
    <!-- ì‚¬ì´ë“œë°” ë²„íŠ¼ -->
    <aside class="sidebar">
      <button id="sidebarCctvBtn" title="CCTV"><i class="fas fa-video"></i></button>
      <button id="sidebarEventBtn" title="ë„ë¡œ ì´ë²¤íŠ¸"><i
          class="fas fa-triangle-exclamation popup-box event-popup"></i></button>
      <button id="sidebarBusBtn" title="ë²„ìŠ¤ ìœ„ì¹˜"><i class="fas fa-bus"></i></button>
      <button id="sidebarRouteBtn" title="ê¸¸ì°¾ê¸°"><i class="fas fa-route"></i></button>
      <button id="sidebarBikeBtn" title="ë”°ë¦‰ì´ ëŒ€ì—¬ì†Œ"><i class="fas fa-bicycle popup-box bike-popup"></i></button>
      <button id="sidebarSubwayBtn" title="ì§€í•˜ì² "><i class="fas fa-train-subway"></i></button>
      <button id="sidebarParkingBtn" title="ì£¼ì°¨ì¥"><i class="fas fa-p"></i></button>
    </aside>

    <!-- ì§€ë„ -->
    <div id="map" style="width: 100%; height: 100vh;"></div>

    <!-- ì§€ë„ íƒ€ì… + êµí†µì •ë³´ í† ê¸€ ê·¸ë£¹ -->
    <div id="mapTypeControl" class="btn-group btn-group-sm position-absolute top-0 end-0 m-3 shadow" role="group">
      <button class="btn btn-outline-light active" data-type="NORMAL"><i class="fas fa-map"></i> ì¼ë°˜</button>
      <button class="btn btn-outline-light" data-type="SATELLITE"><i class="fas fa-satellite"></i> ìœ„ì„±</button>
      <button class="btn btn-outline-light" data-type="HYBRID"><i class="fas fa-layer-group"></i> ì§€í˜•</button>
      <button id="toggleTrafficLayer" class="btn btn-outline-light" data-type="TRAFFIC"><i class="fas fa-road"></i>
        êµí†µì •ë³´</button>
    </div>

    <!-- ì»¤ìŠ¤í…€ ì¤Œ ì»¨íŠ¸ë¡¤ -->
    <div id="customZoomScroll"
      class="position-absolute top-50 translate-middle-y end-0 me-3 z-1000 d-flex flex-column align-items-center">
      <button class="btn btn-light btn-sm mb-1" id="zoomInBtn"><i class="fas fa-plus"></i></button>

      <!-- ì„¸ë¡œ ìŠ¬ë¼ì´ë” -->
      <input type="range" id="zoomSlider" min="6" max="20" value="14" step="1">

      <button class="btn btn-light btn-sm mt-1" id="zoomOutBtn"><i class="fas fa-minus"></i></button>
    </div>


    <!-- CCTV ì˜ìƒì°½ -->
    <div id="videoContainer" style="display: none;">
      <div class="video-header">
        <span id="videoTitle" class="video-title"></span>
        <button id="closeVideoBtn" class="video-close-btn">X</button>
      </div>
      <video id="cctvVideo" controls autoplay muted></video>
      <div class="video-footer">
        <button id="fullscreenBtn" class="video-bottom-btn">ì „ì²´í™”ë©´</button>
        <button id="openNewTabBtn" class="video-bottom-btn">ìƒˆì°½</button>
      </div>
    </div>

    <!-- CCTV ê²€ìƒ‰ íŒ¨ë„ -->
    <div id="cctvFilterPanel" class="cctv-panel" style="display: none;">
      <!-- âœ… ìƒë‹¨ íƒ­ ë²„íŠ¼ -->
      <div class="cctv-tab-bar">
        <button id="tabHighway" class="btn btn-outline-primary btn-sm w-100 mx-1">ê³ ì†ë„ë¡œ</button>
        <button id="tabNormalroad" class="btn btn-outline-primary btn-sm w-100 mx-1">êµ­ë„</button>
      </div>
      <!-- âœ… ë„ë¡œ ë¦¬ìŠ¤íŠ¸ (ê¸°ë³¸ ë³´ì„) -->
      <ul id="roadList" class="list-group cctv-list scrollable-list"></ul>

      <!-- âœ… ì§€ë„ íƒ€ì… ë²„íŠ¼ (í•˜ë‹¨ ê³ ì •) -->
      <div id="mapTypeButtons" class="map-type-buttons">
        <button class="map-type-btn" data-type="NORMAL">ì¼ë°˜ì§€ë„</button>
        <button class="map-type-btn" data-type="SATELLITE">ìœ„ì„±ì§€ë„</button>
        <button class="map-type-btn" data-type="HYBRID">í•­ê³µì§€ë„</button>
      </div>
    </div>

    <!-- ğŸšŒ ì •ë¥˜ì¥ ë§ˆì»¤ + ë²„ìŠ¤ ì¶”ì  í†µí•© íŒ¨ë„ -->
    <div id="busFilterPanel" class="bus-panel" style="display: none;">

      <!-- ğŸ”¹ ê³ ì • í—¤ë” -->
      <div class="flex-shrink-0">
        <div class="bus-header bg-primary text-white py-2 px-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-signpost-2-fill me-1"></i> ë²„ìŠ¤ ì •ë³´</h5>
          <button id="resetMapBtn" class="btn btn-sm btn-light" onclick="resetBusStopPanel()" title="ëª©ë¡ ì´ˆê¸°í™”">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>

        <div class="p-3 d-flex flex-column gap-3">
          <!-- ì§€ì—­ ì„ íƒ -->
          <div>
            <select id="regionSelector" class="form-select form-select-sm">
              <option value="" selected disabled hidden>ì‹œ/ë„ ì„ íƒ</option>
            </select>
          </div>

          <!-- ë²„ìŠ¤ ë²ˆí˜¸ ê²€ìƒ‰ -->
          <div class="input-group">
            <input type="text" id="routeInput" class="form-control" placeholder="ë²„ìŠ¤ ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 100)">
            <button class="btn btn-primary" onclick="searchBusRoute()">ê²€ìƒ‰</button>
          </div>

          <div>
            <button class="btn btn-primary btn-sm w-100" onclick="findNearbyStops()">ğŸ“ ë‚´ ì£¼ë³€ ì •ë¥˜ì†Œ</button>
          </div>

          <!-- ë„ì°© ì •ë³´ ì œëª©ë§Œ ê³ ì • -->
          <div id="arrivalPanelBox">
            <h6 class="fw-bold border-bottom pb-2">ğŸšŒ ë„ì°© ì •ë³´</h6>
          </div>
        </div>
      </div>

      <!-- ğŸ”¹ ìŠ¤í¬ë¡¤ë˜ëŠ” ì˜ì—­: ë„ì°© ì •ë³´ ëª©ë¡ -->
      <div class="flex-grow-1 overflow-auto px-3 pb-3" id="arrivalPanelBody" style="font-size: 0.9rem;">
        <div class="text-muted">ì›í•˜ì‹œëŠ” ì •ë¥˜ì¥ì„ ì„ íƒí•˜ì„¸ìš”</div>
      </div>

      <!-- ğŸ”¹ í‘¸í„° ê³ ì • -->
      <div class="panel-footer text-center flex-shrink-0 py-2 px-3 border-top bg-light">
        <small class="text-muted">â€» ì‹œ/ë„ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë²„ìŠ¤ ë²ˆí˜¸ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”.</small>
      </div>
    </div>

    <div id="busRouteFloatingPanel" class="card shadow-sm position-absolute"
      style="top: 60px; right: 20px; width: 320px; z-index: 1000; display: none;">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong id="busRouteFloatingTitle">123ë²ˆ ë²„ìŠ¤</strong>
        <button class="btn btn-sm btn-outline-secondary" onclick="closeRouteFloatingPanel()">âœ•</button>
      </div>
      <div class="card-body" id="busRouteFloatingBody">
        <div>ğŸš ì •ë¥˜ì¥ ìˆ˜: <span id="stopCount"></span></div>
        <div>ğŸ•’ ë°°ì°¨: <span id="intervalTime"></span></div>
        <div>ğŸš€ ê²½ë¡œê°€ ì§€ë„ì— í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.</div>
      </div>
    </div>

    <!-- ğŸ§­ ê¸¸ì°¾ê¸° ì‚¬ì´ë“œë°” íŒ¨ë„ -->
    <div id="routeFilterPanel" class="sidebar-panel" style="display: none;">

      <div class="flex-shrink-0">
        <div class="bus-header bg-primary text-white py-2 px-3 d-flex justify-content-between align-items-center">
          <h5>ğŸ§­ ê¸¸ì°¾ê¸°</h5>
        </div>

        <!-- ğŸ” ì¥ì†Œ ê²€ìƒ‰ -->
        <div>
          <input id="placeSearchInput" class="form-control form-control-sm" placeholder="ğŸ” ì›í•˜ëŠ” ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”">
          <ul id="placeSearchResults" class="list-group mt-1" style="max-height: 150px; overflow-y: auto;"></ul>
        </div>

        <!-- ğŸ“ ë°˜ê²½ ì¹´í…Œê³ ë¦¬ + ìŠ¬ë¼ì´ë” -->
        <div class="input-group">
          <select id="categorySelect" class="form-select form-select-sm">
            <option value="MT1">ğŸ›’ ëŒ€í˜•ë§ˆíŠ¸</option>
            <option value="CS2">ğŸª í¸ì˜ì </option>
            <option value="PS3">ğŸ’ ì–´ë¦°ì´ì§‘/ìœ ì¹˜ì›</option>
            <option value="SC4">ğŸ« í•™êµ</option>
            <option value="AC5">ğŸ“š í•™ì›</option>
            <option value="PK6">ğŸ…¿ï¸ ì£¼ì°¨ì¥</option>
            <option value="OL7">â›½ ì£¼ìœ ì†Œ</option>
            <option value="SW8">ğŸš‡ ì§€í•˜ì² ì—­</option>
            <option value="BK9">ğŸ¦ ì€í–‰</option>
            <option value="CT1">ğŸ­ ë¬¸í™”ì‹œì„¤</option>
            <option value="AG2">ğŸ  ì¤‘ê°œì—…ì†Œ</option>
            <option value="PO3">ğŸ› ê³µê³µê¸°ê´€</option>
            <option value="AT4">ğŸ—ºï¸ ê´€ê´‘ëª…ì†Œ</option>
            <option value="AD5">ğŸ¨ ìˆ™ë°•</option>
            <option value="FD6" selected>ğŸ½ ìŒì‹ì </option>
            <option value="CE7">â˜• ì¹´í˜</option>
            <option value="HP8">ğŸ¥ ë³‘ì›</option>
            <option value="PM9">ğŸ’Š ì•½êµ­</option>
          </select>
        </div>

        <!-- ë„ì°© ì •ë³´ ì œëª©ë§Œ ê³ ì • -->
        <div id="arrivalPanelBox">
          <button class="btn btn-outline-primary w-100 btn-sm" onclick="searchFromMap()">ğŸ“ ì§€ë„ ì¤‘ì‹¬ ê²€ìƒ‰</button>
        </div>
      </div>

      <!-- ğŸ”½ ìŠ¤í¬ë¡¤ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
      <div class="flex-grow-1 overflow-auto px-3 pb-3" id="nearbyPlaceList" style="font-size: 0.9rem;">
        <div class="text-muted">ğŸ” ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ê±°ë‚˜ ë‚´ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</div>
      </div>

      <!-- ğŸ”½ ê³ ì • í‘¸í„° -->
      <div class="panel-footer text-center py-2 px-3 border-top bg-light">
        <button class="btn btn-danger w-100" onclick="resetRoutePanel()">ğŸ” ì´ˆê¸°í™”</button>
      </div>
    </div>

    <!-- âœ… êµí†µì†ë„ ë²”ë¡€ ë°•ìŠ¤ (ê¸°ë³¸ì€ ìˆ¨ê¹€) -->
    <div id="trafficLegendBox" class="traffic-legend-box">
      <div><span class="legend-box" style="background-color: #28a745;"></span> ì›í™œ (41km/h ì´ìƒ)</div>
      <div><span class="legend-box" style="background-color: #ffc107;"></span> ë³´í†µ (21~40km/h)</div>
      <div><span class="legend-box" style="background-color: #dc3545;"></span> ì •ì²´ (0~20km/h)</div>
    </div>

    <!-- âœ… ì˜¤ë¥¸ìª½ ì „êµ­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ -->
    <div id="eventListPanel" style="display: none;">
      <h6 class="fw-bold mb-3">ğŸ“ ë„ë¡œ ì´ë²¤íŠ¸ ëª©ë¡</h6>
      <div id="eventListContent" class="d-flex flex-column gap-2"></div>
    </div>

    <!-- ìƒì„¸ ë‚´ìš© íŒ¨ë„ -->
    <div id="eventInfoBox" class="event-info-box" style="display: none;">
    </div>

    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div id="loadingSpinner" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- ğŸ…¿ï¸ ì£¼ì°¨ì¥ ë²”ë¡€ ë°•ìŠ¤ (ê¸°ë³¸ ìˆ¨ê¹€) -->
    <div id="parkingLegendBox" class="position-absolute bottom-0 end-0 m-3 p-3 bg-white shadow-sm rounded small"
      style="display: none; z-index: 1000;">
      <strong class="d-block mb-2 text-center"><i class="fa-solid fa-square-parking"></i> ì£¼ì°¨ì¥ ìƒíƒœ</strong>
      <div class="d-flex align-items-center mb-1">
        <img src="/image/parking/green-icon.png" width="25" class="me-2" />
        <span>ì›í™œ (30% ì´ìƒ)</span>
      </div>
      <div class="d-flex align-items-center mb-1">
        <img src="/image/parking/yellow-icon.png" width="25" class="me-2" />
        <span>í˜¼ì¡ (0~30%)</span>
      </div>
      <div class="d-flex align-items-center mb-1">
        <img src="/image/parking/red-icon.png" width="25" class="me-2" />
        <span>ë§Œì°¨</span>
      </div>
      <div class="d-flex align-items-center">
        <img src="/image/parking/gray-icon.png" width="25" class="me-2" />
        <span>ê²€ìƒ‰ ì œì™¸</span>
      </div>
    </div>


    <!--ë”°ë¦‰ì´ ìƒì„¸ì •ë³´ ì™¼ìª½ íŒ¨ë„ -->
    <div id="stationDetailPanel" class="info-panel" style="display: none;">
      <h4 id="detailStationName">ğŸš² ëŒ€ì—¬ì†Œ ì´ë¦„</h4>
      <p id="detailStationInfo">ì—¬ê¸°ì— ìƒì„¸ ì„¤ëª…ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
      <p id="detailStationDistance">ê±°ë¦¬: ê³„ì‚° ì¤‘...</p>


      <!-- ë”°ë¦‰ì´ ì•ˆë‚´ / ì·¨ì†Œ ë²„íŠ¼ -->
      <div class="btn-group mt-3 w-100">
        <button class="btn btn-primary w-100" onclick="goToNaverRoute()">ğŸ§­ ì•ˆë‚´</button>
        <button class="btn btn-secondary w-100" onclick="cancelBikeRoute()">âŒ ì·¨ì†Œ</button>
      </div>

      <!-- ë”°ë¦‰ì´ ì¶”ì²œ / ìœ„ì¹˜ ì´ë™ ë²„íŠ¼ -->
      <div class="btn-group mt-3 w-100">
        <button id="recommendBtn" class="btn btn-outline-success w-100">ğŸš² ì¶”ì²œ ëŒ€ì—¬ì†Œ ë³´ê¸°</button>
        <button id="moveToMyLocation" class="btn btn-outline-primary w-100">ğŸ“ ë‚´ ìœ„ì¹˜ë¡œ ì´ë™</button>
      </div>

      <!-- ë”°ë¦‰ì´ ! -->
      <div style="margin-top: 12px; text-align: right;">
        <button id="closeDetailPanel" class="close-btn">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- ğŸš‡ ì§€í•˜ì²  íŒ¨ë„ ë‚´ë¶€ -->
    <div id="subwayFilterPanel" style="display: none; flex-direction: column;">
      <h5 class="mt-3 px-3">ğŸš‡ ì§€í•˜ì²  ì •ë³´</h5>

      <!-- í˜¸ì„  ì²´í¬ í•„í„° -->
      <div class="px-3 mb-2">
        <label class="form-label">í‘œì‹œí•  í˜¸ì„  ì„ íƒ</label>
        <div id="lineCheckboxContainer" class="d-flex flex-wrap gap-2"></div>
      </div>

      <!-- ì¶œë°œ/ë„ì°©ì—­ ì…ë ¥ -->
      <div class="px-3">
        <div class="input-group mb-2">
          <input id="startStationInput" class="form-control" placeholder="ğŸš© íƒ‘ìŠ¹ì—­ (ì˜ˆ: ì„œìš¸ì—­)" />
        </div>
        <div class="input-group mb-2">
          <input id="endStationInput" class="form-control" placeholder="ğŸ í•˜ì°¨ì—­ (ì˜ˆ: ì¢…ê°)" />
        </div>

        <!-- ê²½ë¡œ ê²€ìƒ‰ ë²„íŠ¼ -->
        <button class="btn btn-success w-100 mb-2" onclick="findSubwayRoute()">ğŸ” ê²½ë¡œ ê²€ìƒ‰</button>
      </div>

      <!-- âœ… ê²½ë¡œ ê²°ê³¼ ì¶œë ¥ -->
      <div id="routeResultBox" class="px-3 mb-3" style="font-size: 14px;"></div>
    </div>

    <!-- ğŸ…¿ï¸ ì£¼ì°¨ì¥ ê²€ìƒ‰ íŒ¨ë„ -->
    <div id="parkingFilterPanel" style="display: none; flex-direction: column;">
      <!-- âœ… ê³ ì • ì˜ì—­ ì „ì²´ -->
      <div class="parking-header-sticky" style="position: sticky; top: 0; z-index: 10;">
        <!-- í—¤ë” -->
        <div class="parking-header py-2 px-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-car-front-fill me-1"></i> ì„œìš¸ì‹œ ì£¼ì°¨ì¥</h5>
          <button class="btn btn-sm btn-light" onclick="resetParkingPanel()" title="ëª©ë¡ ì´ˆê¸°í™”">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>

        <!-- í•„í„° & ê²€ìƒ‰ -->
        <div class="p-3 border-bottom">
          <div class="row g-2 mb-2">
            <div class="col">
              <select id="parkingGuSelect" class="form-select form-select-sm" onchange="filterParkingByRegion()">
                <option value="">ì „ì²´ êµ¬</option>
              </select>
            </div>
            <div class="col">
              <select id="parkingDongSelect" class="form-select form-select-sm" onchange="filterParkingByRegion()">
                <option value="">ì „ì²´ ë™</option>
              </select>
            </div>
          </div>
          <div class="row g-2 mb-2">
            <div class="col">
              <select id="payTypeSelect" class="form-select form-select-sm" onchange="applyAdvancedParkingFilters()">
                <option value="">ì „ì²´ ìš”ê¸ˆ</option>
                <option value="ìœ ë£Œ">ìœ ë£Œ</option>
                <option value="ë¬´ë£Œ">ë¬´ë£Œ</option>
              </select>
            </div>
            <div class="col">
              <select id="parkingTypeSelect" class="form-select form-select-sm"
                onchange="applyAdvancedParkingFilters()">
                <option value="">ì „ì²´ ì¢…ë¥˜</option>
                <option value="ë…¸ìƒ ì£¼ì°¨ì¥">ë…¸ìƒ</option>
                <option value="ë…¸ì™¸ ì£¼ì°¨ì¥">ë…¸ì™¸</option>
              </select>
            </div>
          </div>
          <div class="input-group mb-3">
            <input id="parkingSearchInput" type="text" class="form-control form-control-sm" placeholder="ì£¼ì°¨ì¥ ì´ë¦„ ê²€ìƒ‰" />
            <button class="btn btn-sm btn-outline-primary" onclick="searchParking()" title="ê²€ìƒ‰">
              <i class="bi bi-search"></i>
            </button>
          </div>
          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="onlyAvailableCheckbox"
              onchange="filterParkingByRegion()">
            <label class="form-check-label small" for="onlyAvailableCheckbox">ì£¼ì°¨ ê°€ëŠ¥ ì£¼ì°¨ì¥ë§Œ ë³´ê¸°</label>
          </div>

          <div>
            <small id="parkingCountText" class="text-muted">ì´ <span id="parkingCount">0</span>ê±´ ê²€ìƒ‰ë¨</small>
          </div>
        </div>
      </div>

      <!-- ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
      <div id="parkingListBox" class="list-group flex-grow-1 overflow-auto border-top" style="min-height: 100px;">
        <!-- ë¦¬ìŠ¤íŠ¸ í•­ëª©ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>

      <!-- í‘¸í„° -->
      <div class="border-top py-2 px-3 bg-light text-center">
        <small class="text-muted">â€» ì£¼ì°¨ì¥ ì´ë¦„ì„ ì…ë ¥í•˜ì—¬ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
      </div>
    </div>

    <!-- ë²„ìŠ¤ ìƒì„¸ íŒì—… -->
    <div id="routeDetailPopup" class="card shadow-sm border position-absolute d-none"
      style="z-index: 2000; width: 250px;">
      <div class="card-body p-3 small">
        <div id="routeDetailPopupContent">ë¡œë”© ì¤‘...</div>
      </div>
    </div>

    <!-- í˜ì´ì§€ ì–´ë”˜ê°€ì— ê¸°ë³¸ í‹€ë§Œ ë§ˆë ¨ -->
    <div id="routePanel" class="bus-route-panel" style="display: none;">
      <div class="header" id="routePanelHeader"></div>
      <div class="route-timeline" id="routeTimelineContainer"></div>
    </div>

    <!-- ğŸŸ¢ ë…¸ì„  ì •ë³´ íŒ¨ë„ ìƒë‹¨ -->
    <div id="busRoutePanel" class="offcanvas offcanvas-end">
      <div class="offcanvas-header">
        <h5 id="routeHeader">ë…¸ì„  ì œëª©</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
      </div>
      <div class="offcanvas-body">
        <div id="routeSubInfo" class="text-muted mb-2">ë¶€ì œëª© ì •ë³´</div>

        <div id="busStopListContainer">
          <!-- ì •ë¥˜ì¥ ëª©ë¡ì´ ì—¬ê¸° ì±„ì›Œì§ -->
        </div>
      </div>
    </div>

    <script th:src="@{/js/cctv.js}" defer></script> <!-- ìˆ˜ì • -->
    <script type="module" src="/js/bus.js" defer></script>
    <script type="module" src="/js/bike.js" defer></script>
    <script type="module" src="/js/direction.js" defer></script>
    <script type="module" src="/js/event-layer.js" defer></script>
    <script src="/js/subway.js" defer></script>
    <script src="/js/parking.js" defer></script>
    <script src="/js/realtime-traffic.js" defer></script>
    <script src="/js/traffic.js" defer></script> <!-- ë©”ì¸ -->

    <script>
      function isVisible(el) {
        return el && window.getComputedStyle(el).display !== "none";
      }

      function adjustLegendPositions() {
        const trafficBox = document.getElementById("trafficLegendBox");
        const parkingBox = document.getElementById("parkingLegendBox");

        const trafficVisible = isVisible(trafficBox);
        const parkingVisible = isVisible(parkingBox);

        if (trafficVisible) {
          trafficBox.style.position = "fixed";
          trafficBox.style.bottom = "16px";

          if (parkingVisible) {
            const parkingWidth = parkingBox.offsetWidth || 240;
            const gap = 20;
            trafficBox.style.setProperty("right", `${parkingWidth + gap}px`, "important");
          } else {
            trafficBox.style.setProperty("right", "16px", "important");
          }
        }

        if (parkingVisible) {
          parkingBox.style.position = "fixed";
          parkingBox.style.bottom = "16px";
          parkingBox.style.right = "16px";
        }
      }

      function showTrafficLegend() {
        const box = document.getElementById("trafficLegendBox");
        box.style.display = "block";
        adjustLegendPositions();
      }

      function hideTrafficLegend() {
        const box = document.getElementById("trafficLegendBox");
        box.style.display = "none";
        adjustLegendPositions();
      }

      function showParkingLegend() {
        const box = document.getElementById("parkingLegendBox");
        box.style.display = "block";
        adjustLegendPositions();
      }

      function hideParkingLegend() {
        const box = document.getElementById("parkingLegendBox");
        box.style.display = "none";
        adjustLegendPositions();
      }
    </script>

</body>

</html>